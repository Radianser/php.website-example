const app=Vue.createApp({data:()=>({SESSION:{cart:[],quantity:0,total:0,user:{login:null,id:null,nickname:null,age:null}},min:500,mobile:null}),methods:{showPhoneMenu(){let e=document.querySelector("html"),t=document.querySelector("div.phone-sidebar"),r=document.querySelector(".screen");r.addEventListener("click",this.hidePhoneMenu),t.style.left="0",r.style.display="block",e.style.overflow="hidden"},hidePhoneMenu(e){let t=document.querySelector("html");document.querySelector("div.phone-sidebar").style.left="-70vw",e.target.style.display="none",t.style.overflow="visible",e.target.removeEventListener("click",this.hidePhoneMenu)},showCart(){let e=document.querySelector("html"),t=document.querySelector("div.cart"),r=document.querySelector(".screen");r.addEventListener("click",this.hideCart),t.style.display="block",r.style.display="block",e.style.overflow="hidden"},hideCart(e){let t=document.querySelector("html"),r=document.querySelector("div.cart"),i=document.querySelector(".screen");r.style.display="none",i.style.display="none",t.style.overflow="visible",e.target.removeEventListener("click",this.hideCart)},addProduct(e){let t={action:"add",id:e.target.dataset.id};fetch("http://localhost/cart.php",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{if(!0!==e[1])alert(e[1]);else for(let t in e[0])this.SESSION[t]=e[0][t]}))},changeQuantity(e){let t=e.target.dataset.id,r={action:e.target.dataset.action,id:t};fetch("http://localhost/cart.php",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(r)}).then((e=>e.json())).then((e=>{let t=document.querySelector(".discount");t&&(t.value="");for(let t in e)this.SESSION[t]=e[t];let r=document.querySelector("input.self-pickup");r&&(r.checked=!0,this.offAddresses())}))},removeProduct(e){let t={action:"remove",id:e.target.dataset.id};e.target.closest("div.cart-product-line").remove(),fetch("http://localhost/cart.php",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{let t=document.querySelector(".discount");t&&(t.value="");for(let t in e)this.SESSION[t]=e[t]}))},usePoints(e){let t={action:"use_points",points:e.target.value};fetch("http://localhost/cart.php",{method:"POST",headers:{"Content-type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then((e=>e.json())).then((t=>{let r=document.querySelector("div.total");0==t.check?(e.target.value="",r.innerHTML=t.total,alert("Points entered incorrectly")):r.innerHTML=t.total-e.target.value}))},showEditForm(e){let t=document.querySelector(".edit-form.nickname"),r=document.querySelector(".edit-form.phone"),i=document.querySelector(".edit-form.img"),o=document.querySelector(".phone-input");o&&(o.addEventListener("keydown",this.inputDigits),o.addEventListener("blur",this.checkInput));let d=e.target.dataset.form,a=document.querySelector(".screen");a.addEventListener("click",this.hideEditForm),a.style.display="block","nickname"==d?(t.classList.remove("hidden"),t.classList.add("active")):"phone"==d?(r.classList.remove("hidden"),r.classList.add("active")):(i.classList.remove("hidden"),i.classList.add("active"))},hideEditForm(e){let t=e.target,r=document.querySelector(".edit-form.active");r&&(r.classList.remove("active"),r.classList.add("hidden")),t.style.display="none",t.removeEventListener("click",this.hideEditForm)},inputDigits(e){0==e.shiftKey?(e.keyCode<8||e.keyCode>8&&e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105)&&e.preventDefault():e.preventDefault()},checkInput(e){if(""!=e.target.value&&"+"!=e.target.value[0])if(8==e.target.value[0]||7==e.target.value[0]){let t=e.target.value;e.target.value="+7"+t.substring(1)}else e.target.value="+7"+e.target.value},offAddresses(){let e=document.querySelector(".shopping-cart-addresses");document.querySelector(".hidden").checked=!0,e.classList.add("hidden")},onAddresses(){let e=document.querySelector(".shopping-cart-addresses");document.querySelector(".hidden").checked=!0,e.classList.remove("hidden")},checkFormData(e){e.preventDefault();let t=document.querySelector("#order-form"),r=new FormData(t),i=Array.from(r);6==i.length&&"no_address"==i[2][1]&&"delivery"==i[1][1]?alert("Address not selected!"):this.makeOrder(i)},makeOrder(e){let t={action:"order",order_details:e};fetch("http://localhost/cart.php",{method:"POST",headers:{"Content-type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{1==e?location.href="/success":alert("An error has occurred. Please try again later.")}))},glideEffect(e){let t=e.target.closest("div.main-img"),r=getComputedStyle(t),i=Math.round(e.clientX-Number(r.width.slice(0,-2))/2),o=Math.round(e.clientY-100-Number(r.height.slice(0,-2))/2);t.style.cssText+=`--coordinate-x: ${50-i/100}%; --coordinate-y: ${50-o/100}%`},serverDataSync(){fetch("http://localhost/cart.php",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({action:"sync"})}).then((e=>e.json())).then((e=>{for(let t in e)this.SESSION[t]=e[t]}))},returnData:e=>e,imgName(e){let t,r="/images/products/";return t=e.indexOf(" ")>-1?r+e.split(" ").join("_")+".webp":r+e+".webp",t}},created(){window.addEventListener("resize",(()=>{window.innerWidth<1e3?this.mobile=!0:this.mobile=!1})),window.addEventListener("scroll",(()=>{let e=document.querySelector(".header"),t=document.querySelector(".main");window.scrollY>0?(e.style.height="70px",t.style.marginTop="70px"):(e.style.height="100px",t.style.marginTop="100px");let r=document.querySelector(".parallax");r&&window.scrollY>1470&&(r.style.cssText+=`--coordinate-y: ${110-Math.round(window.scrollY/50)}%`)}))},mounted(){this.serverDataSync(),window.innerWidth<1e3?this.mobile=!0:this.mobile=!1}});app.component("shopping-cart",{props:["session","imgName","returnData","changeQuantity","removeProduct"],data:()=>({}),template:"\n        <div class='cart-header' v-if=\"session['cart'] != null && session['cart'].length != 0\">\n            <div class='cart-product-header product-id'>#id</div>\n            <div class='cart-product-header product-img'>image</div>\n            <div class='cart-product-header'>name</div>\n            <div class='cart-product-header'>count</div>\n            <div class='cart-product-header'>price,₽</div>\n            <div class='cart-product-header'>cost,₽</div>\n            <div class='cart-product-header'></div>\n        </div>\n        <div class='cart-header' v-else></div>\n        <div class='cart-products' v-if=\"session['cart'] != null && session['cart'].length != 0\">\n        <div class='cart-product-line' v-for=\"(item, key) in session['cart']\" :key=\"key\">\n            <div class='cart-product-info product-id'>{{ item.id }}</div>\n            <div class='cart-product-info product-img'><img :src='imgName(item.name)' :alt='returnData(item.name)' loading='lazy'/></div>\n            <div class='cart-product-info'>{{ item.name }}</div>\n            <div class='cart-product-info'>\n                <div class='counter-btn decrement' :data-id='returnData(item.id)' data-action='decrement' @click='changeQuantity'>-</div>\n                <div class='product-counter'>{{ item.count }}</div>\n                <div class='counter-btn increment' :data-id='returnData(item.id)' data-action='increment' @click='changeQuantity'>+</div>\n            </div>\n            <div class='cart-product-info'>{{ item.price }}</div>\n            <div class='cart-product-info product-cost'>{{ item.cost }}</div>\n            <div class='cart-product-info remove-btn' :data-id=\"returnData(item.id)\" @click='removeProduct'></div>\n        </div>\n        </div>\n        <div class='cart-products' v-else>The shopping cart is empty</div>\n        <div class='cart-footer'>\n            <div class='cart-product-footer product-id'></div>\n            <div class='cart-product-footer product-img'></div>\n            <div class='cart-product-footer'></div>\n            <div class='cart-product-footer'></div>\n            <div class='cart-product-footer'></div>\n            <div class='cart-product-footer total' v-if=\"session['cart'] != null && session['cart'].length != 0\">{{ session['total'] }}</div>\n            <div class='cart-product-footer total' v-else></div>\n            <div class='cart-product-footer'></div>\n        </div>\n    "}),app.mount("#app");